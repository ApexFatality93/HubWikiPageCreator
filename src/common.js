const regions={GHub:{F9556C30:"The Arm of Vezitinen",F9555C30:"Canthian",F9555C31:"Dexterf Sector",F9556C31:"The Arm of Katteus",F9557C31:"Nugsdor Adjunct",F9557C30:"Uefert Nebula",F9557C2F:"Widraik",F9556C2F:"Airnaka Conflux",F9555C2F:"Sivess Instability",FA556C30:"Savenix Instability",F8556C30:"Nonlopsi Instability"},CalHub:{F9556C30:"Uisaor Spur",F9555C30:"The Arm of Kiffeyn",F9555C31:"Ilongl Cloud",F9556C31:"The Arm of Taticale",F9557C31:"Egerap Anomaly",F9557C30:"Wakestones Expanse",F9557C2F:"Erhahn Fringe",F9556C2F:"Imrikians Terminus",F9555C2F:"Imedeili",FA556C30:"Kovasu Adjunct",F8556C30:"Lossians Boundary"},EisHub:{F9556C30:"Riwala",F9555C30:"Omskio Instability",F9555C31:"Marcki",F9556C31:"Anolamga Spur",F9557C31:"Sea of Zonyayp",F9557C30:"Rayuyar Band",F9557C2F:"Umaton Instability",F9556C2F:"Exramb Adjunct",F9555C2F:"Ologowe Fringe",FA556C30:"Yatrifex",FA555C30:"Yeiada Sector",FA555C31:"Iptrevs Fringe",FA556C31:"Yamiraith Sector",FA557C31:"Wedragi Spur",FA557C30:"Rezhensk",FA557C2F:"Sobert Cloud",FA556C2F:"Umtats Anomaly",FA555C2F:"Tavill",F8556C30:"Qangew Expanse",F8555C30:"Nijhwal Boundary",F8555C31:"Usband Cluster",F8556C31:"Ejongaa Anomaly",F8557C31:"Zahrel Expanse",F8557C30:"The Arm of Fupand",F8557C2F:"Cuculta",F8556C2F:"Etmarao",F8555C2F:"Otreie Void"}},GHubHuburbRegions={FA555C30:"Wekeram Conflux",FA555C31:"Ahomas Fringe",FA556C31:"Nudryorob Fringe",FA557C31:"Urzews Instability",FA557C30:"Ercays",FA557C2F:"Dahiloci Conflux",FA556C2F:"Rapphosu",FA555C2F:"Kemurrim Expanse",F8555C30:"Ardarea Sector",F8555C31:"Cetrocho Spur",F8556C31:"Guitat Cloud",F8557C31:"Unceto Cloud",F8557C30:"Yamurab Instability",F8557C2F:"Tenavata Terminus",F8556C2F:"Menacaro",F8555C2F:"Ziessuw Mass"};function addHuburbs(e){e.GHub??=new Object;for(const t in GHubHuburbRegions)e.GHub[t]=GHubHuburbRegions[t]}"undefined"!=typeof huburbs&&huburbs&&addHuburbs(regions),Object.freeze(regions);const versions=["Fractal","Waypoint","Endurance","Outlaws","SentinelUp","Frontiers","Prisms","Expeditions","Companions","NextGen","Origins","Desolation","Crossplay","ExoMech","Living Ship","Synthesis","Beyond","Visions","Abyss","NEXT","Atlas Rises","Pathfinder","Foundation","Release"],vowels="aeiou",wikiLink="https://nomanssky.fandom.com/wiki/";let uploadShown=!1;const links=new Object,pageData=new Object,dataIntegrityObj={text:"",copy:""},globalElements={input:{},output:{}},commonElements={input:{version:"versionInput",civ:"civInput",fileInput:"fileInput",fileUpload:"fileUpload",portalglyphsInput:"portalglyphsInput",researchTeam:"researchteamInput",galleryUpload:"galleryUpload"},output:{output:"output",portalglyphButtons:"portalglyphButtons",galleryItems:"galleryItems",galleryCode:"galleryCode",explanation:"explanation",fullArticle:"fullArticle",actions:"actions",albumActions:"albumActions",albumEntry:"albumEntry",footer:"footer"}},elementFunctions={nameInput:["enableTextMarking()"],researchTeam:["researchTeam(); docBy()"],civ:["civ()"],portalglyphsInput:["glyphInputOnChange(this); displayGlyphs(); enableTextMarking()"],discoveredInput:['hideDiscoverer("discoveredInput", "discoveredlinkInput"); docBy()'],discoveredlinkInput:['hideDiscoverer("discoveredlinkInput", "discoveredInput"); docBy()'],docbyInput:["docBy()"],axesInput:["validateCoords()","onchange"]};function addInputs(){var e=document.querySelectorAll("input, select, textarea"),t=Object.values(commonElements.input);for(const n of e)t.includes(n.id)||(commonElements.input[n.id]=n.id)}function addOutputs(){var e,t=document.getElementsByTagName("output"),n=Object.values(commonElements.output);for(const a of t)n.includes(a.name)||n.includes(a.id)||(e=a.name||a.id,commonElements.output[e]=e)}function updateGlobalElements(e){for(const a in e)for(const o in e[a]){var t=e[a][o],n=Array.from(document.getElementsByName(t)),t=document.getElementById(t);n.length?e[a][o]=n:e[a][o]=t}for(const i in e)for(const r in e[i])globalElements[i][r]=e[i][r]}function assignElementFunctions(e){for(const a in e)if(globalElements.input[a]){var t=globalElements.input[a],n=e[a][0];if(Array.isArray(t))for(const o of t)assignFunction(o,n,e[a][1],e[a][2]);else assignFunction(t,n,e[a][1],e[a][2])}}function getInputData(){return{inputs:document.querySelectorAll("[data-dest]"),checkboxes:document.querySelectorAll("[data-dest-checkbox]"),stores:document.querySelectorAll("[data-dest-noauto]"),defaults:document.querySelectorAll("[data-default]"),simple:document.querySelectorAll("[data-dest-simple]"),lists:document.querySelectorAll("[list]")}}function startUp(){autoShow(),readDefaultValues(),versionDropdown(),uploadShown=!0,galleryUploadShown=!0,showAll(),pageData.debug||(uploadShown=!1,galleryUploadShown=!1),enableTextMarking(),globalElements.output.output.onmousedown=()=>preventCopy(),globalElements.output.fullArticle.onmouseup=e=>getSelectedText(e.target),globalElements.output.fullArticle.ontouchend=e=>getSelectedText(e.target),globalElements.output.albumText&&(globalElements.output.albumText.ontouchend=e=>getSelectedText(e.target),globalElements.output.albumText.onmouseup=e=>getSelectedText(e.target))}function versionDropdown(){var e=structuredClone(versions),t=e.indexOf("SentinelUp");e.splice(t,1,"Sentinel"),setDropdownOptions(globalElements.input.version,versions,e)}function setDropdownOptions(e,t,n=t){var a=new Array;for(let e=0;e<t.length;e++){var o=t[e],i=n[e],r=document.createElement("option");r.value=o,r.innerText=i,a.push(r.outerHTML)}var s=a.join("");e.innerHTML!=s&&(e.innerHTML=s)}function assignFunction(e,t,n=null,a=!1){const o=e.tagName.toLowerCase(),i=e.type;n=n??("select"==o||"radio"==i||"checkbox"==i?"onchange":"oninput");e.hasAttribute(n)?a?e.setAttribute(n,e.getAttribute(n)+"; "+t):e.setAttribute(n,t+"; "+e.getAttribute(n)):e.setAttribute(n,t)}function autoShow(){var e=getInputData();for(const t of e.defaults)assignFunction(t,"assignDefaultValue(this)");for(const n of e.inputs)assignFunction(n,"wikiCode(this)");for(const a of e.checkboxes)assignFunction(a,"checkboxWikiCode(this)");for(const o of e.stores)assignFunction(o,"storeData(this)");for(const i of e.simple)assignFunction(i,"wikiCodeSimple(this)");for(const r of e.lists)assignFunction(r,"forceDatalist(this)","onchange")}function showAll(){var e=getInputData();for(const t of e.inputs)wikiCode(t);for(const n of e.checkboxes)checkboxWikiCode(n);for(const a of e.stores)storeData(a);for(const o of e.defaults)assignDefaultValue(o);for(const i of e.simple)wikiCodeSimple(i);numberStats(),civ(),image(globalElements.input.fileUpload),"function"==typeof galleryUpload&&galleryUpload();try{glyphInputOnChange(globalElements.input.portalglyphsInput)}catch(e){}try{researchTeam()}catch(e){}try{planetMoonSentence()}catch(e){}hideDiscoverer();try{startupFunctions()}catch(e){console.warn(e)}}function wikiCode(t,e=t.dataset.dest){var n=getDestElements(e),a=sanitiseString(t.value??t);if(e){pageData[e]=a;for(const o of n)try{o.innerText=a}catch(e){console.error("destElement is null. Element:",t,"Value:",a);continue}}else pageData[t.dataset.destNoauto]=a}function getDestElements(e){var t=Array.from(document.getElementsByName(e));return 0==t.length&&t.push(document.getElementById(e)),t}function checkboxWikiCode(e){var t=e.dataset.destCheckbox,n=document.getElementById(t),a=e.value,o=e.dataset.checkboxUnchecked??"";e.checked?(n.innerText=a,pageData[t]=a):(n.innerText=o,pageData[t]=o)}function storeData(e,t=e.dataset.destNoauto){pageData[t]=sanitiseString(e.value)}function externalLinks(){var e;for(const t of document.getElementsByTagName("a"))e=t.href,new URL(e).origin!==location.origin&&(t.target||="_blank",t.rel||="noopener noreferrer")}function openWikiLinksExternally(){for(const t of document.querySelectorAll("a[data-wiki]")){t.target||="_blank",t.rel||="noopener noreferrer",delete t.dataset.wiki;var e=t.getAttribute("href");e.startsWith("http")||(t.href=wikiLink+e)}}function wikiCodeSimple(e){var t=e.dataset.destSimple,n=Array.from(document.getElementsByName(t));n.length||n.push(document.getElementById(t));for(const a of n)a.innerText=e.value}function addStaticPageData(e,t){Object.defineProperty(pageData,e,{configurable:!1,writable:!1,value:t})}function civ(){var e=globalElements?.input?.civ?.value;if(e){var t=new Object;switch(e){case"GHub":t.galaxy="Euclid",t.civilized="Galactic Hub Project",t.civStub="GHub";break;case"CalHub":t.galaxy="Calypso",t.civilized="Galactic Hub Calypso",t.civStub="GHub Calypso";break;case"EisHub":t.galaxy="Eissentam",t.civilized="Galactic Hub Eissentam",t.civStub="GHub Eissentam"}pageData.civShort=e;for(const n in t){pageData[n]=t[n];try{wikiCode(pageData[n],n)}catch(e){}}try{updateCiv()}catch(e){console.warn(e)}}}function updateCiv(){researchTeamDropdown(),glyphRegion(pageData.portalglyphs),docBy()}function sanitiseString(e){const o=["{","}","[","]"];var t=new Array,n=e.split("[http");for(let e=0;e<n.length;e++){var a=function(e,t){let n=e;for(const a of o)n=(t&&"]"==a?function(e,t){var n=e.indexOf(t),e=i(e,t),e=e.split("");return e.splice(n,0,t),e.join("")}:i)(n,a);return n}(n[e],0!=e);t.push(a)}return t.join("[http").trim();function i(e,t){var n=t.repeat(2);return e.split(n).map(e=>e.replaceAll(t,"")).join(n)}}function image(e){var t=e.files[0]?.name;t&&(1e7<e.files[0].size?errorMessage(e,"This file is too big to be uploaded to the wiki. Maximum filesize is 10MB."):errorMessage(e),e=e.previousElementSibling,t=sanitiseString(t),e.value=t,wikiCode(e),uploadShown||(explanation("Upload your picture to the wiki!",`Don't forget to upload your picture to the wiki on <a href="https://nomanssky.fandom.com/wiki/Special:Upload" target="_blank" rel="noopener noreferrer">Special:Upload</a>.
	The upload button only auto-filled the image name into the code, it is not automatically uploaded to the wiki.
	<div class="mt-3"><span class="has-text-weight-bold">NOTE</span>: You can access this popup at any time by clicking on the "?" next to the main image upload button.</div>`),uploadShown=!0))}function toggleSection(e,t,n="section"){var a=document.querySelectorAll(`[data-${n}~="${e}"]`),o=getChildIndex(document.querySelectorAll("[data-button-id]"),"dataset.buttonId");if(0==arguments.length){var i=document.querySelectorAll(".sectionToggle button");for(let e=0;e<i.length;e++){const t=i[e],u=(t.dataset.buttonId??=o+e,t.dataset.buttonId);t.dataset["display"+u]=t.dataset.displayDefault??""}}else{t.dataset.buttonId??=o;const u=t.dataset.buttonId;var r="display"+u,s=t.dataset[r];for(const c of a){var l=c.dataset;let e=!1;for(const d in l)if(d.includes("display")&&d!=r&&"none"==l[d]){e=!0;break}e||(s?(c.style.display="",c.dataset[r]=""):(c.style.display="none",c.dataset[r]="none"))}t.innerText=s?"Hide":"Show",t.dataset[r]=s?"":"none"}}function researchTeamDropdown(e=globalElements.input.researchTeam,t=pageData.civShort){if(e){var n=e.value,a=["","GHGS","GHEC","GHSH","GHDF","GHBG","GHSL","GHTD","HBS"];switch(t){case"CalHub":a.push("CalHub Archivists");break;case"EisHub":a.push("EisHub Scribes","EPC","The Eissentimes Press")}setDropdownOptions(e,a),e.value=n,arguments.length||researchTeam()}}function researchTeam(){var e=globalElements.input.researchTeam;const t=e.value;e=e.dataset.destNoauto;pageData[e]=t;const n=pageData.civilized,a=["Base","Racetrack"];var o=2==t.split(" ").length?n+" "+t.split(" ")[1]:t||a.includes(pageData.pageType)?t:n;globalElements.output[e].innerText=o}function docBy(){var e,t,n,a,o,i;"function"==typeof docByExternal?docByExternal():(a=globalElements.input.docbyInput)&&(e=sanitiseString(a.value),t=pageData.discovered??pageData.builder,n=pageData.discoveredlink??pageData.builderlink,a=a.dataset.destNoauto,o=displayResearch(),i=formatName(e),e&&![t,n].includes(e)?(globalElements.output[a].style.display="",globalElements.output[a].innerText=`Documented by ${o} `+i):globalElements.output[a].style.display="none",addInfoBullet())}function displayResearch(){const e=pageData.researchteam;if(!e)return e;var t=globalElements.input.researchTeam.children,n=new Array;for(const o of t)n.push(o.value);const a=n.indexOf(e);return a<4?`[[${e}]] researcher`:e.includes("Scribe")?"EisHub [[Galactic Hub Eissentam Scribes|Scribe]]":e.includes("Archivist")?"CalHub [[Galactic Hub Calypso Archivists|Archivist]]":`[[${e}]] member`}function formatName(e){return e&&(e.includes("[")||e.includes("{")?e:`''${e}''`)}function hideDiscoverer(e=null,t=null){if(e||t){const l=document.getElementById(e);e=document.getElementById(t);hideInput(e,l.value?"none":""),e.value="",wikiCode(e)}else{const u=document.querySelectorAll('[oninput*="hideDiscoverer"], [onchange*="hideDiscoverer"]');var n,a,o=new Set,i=new Array;for(const c of u)o.has(c)||(n=[(n=c.closest(".tableCell")).previousElementSibling.previousElementSibling.querySelector("input"),n.nextElementSibling.nextElementSibling.querySelector("input")].find(e=>Array.from(u).includes(e)),a=[c,n],o.add(n),i.push(a));for(const d of i){var r=d[0],s=d[1];r.value?hideDiscoverer(r.id,s.id):s.value?hideDiscoverer(s.id,r.id):d.forEach(e=>hideInput(e,""))}}}function addInfoBullet(){var e,t=document.querySelectorAll("[data-add-info]"),n=new Array;for(const a of t)!a.nextElementSibling.style.display&&a.nextElementSibling.innerText&&n.push(a),a.innerHTML="";for(const o of n)1<n.length?(e=o.dataset.addInfo,o.innerHTML=e):o.innerHTML=""}function errorMessage(e,t=null){var n=e.closest(".data");n?.querySelector(".error")?.remove(),e.style.backgroundColor="",n.previousElementSibling.style.alignItems="",t&&(e.style.backgroundColor="red",(e=document.createElement("div")).innerHTML=t,e.className="error",n.appendChild(e),n.previousElementSibling.style.alignItems="baseline")}function validateCoords(e=!0){var t=globalElements.input.axesInput,n=t.value,a=new RegExp(/[+-](?:[0-9]{1,3})\.(?:[0-9]{2}), [+-](?:[0-9]{1,3})\.(?:[0-9]{2})/);if(n&&!regexMatch(n,a))return e&&errorMessage(t,"Invalid coordinate format"),"error";errorMessage(t)}function hideInput(e,t=null){e=e.closest(".tableCell");for(const n of[e.previousElementSibling,e])n.style.display?n.style.display=t??"":n.style.display=t??"none"}function enPrefix(e,t=null){const n=e?.match(/[a-zA-Z]/)?.[0]?.toLowerCase();e=vowels.includes(n)?"an":"a";return t&&wikiCode(e,t),e}function regexMatch(e,t){t=e.match(t);return 1==t?.length&&t[0]?.length==e.length}function docByResearchteam(e){return pageData.researchteam==e?` and documented by the [[Galactic Hub ${{GHSH:"Ship Hunters",GHEC:"Exobiology Corps"}[e]}]]`:""}function shortenGHub(e){return"GHub"==e||"Galactic Hub Project"==e?"Galactic Hub":e}function numberStats(e,t=null,n=!1){if(0==arguments.length)for(const e of document.querySelectorAll('[oninput*="numberStats"]'))numberStats(e);else{var a=e.dataset.destNoauto,o=numberError(e,pageData[a],t,n);getDestElements(a)[0]?wikiCode(o,a):pageData[a]=o}}function numberError(e,t=e.value,n=null,a=!1){n=getNumber(t,n,a);return n||!t||["+","-"].includes(t)?errorMessage(e):errorMessage(e,"Must only contain numbers"),n}function getNumber(e,t=null,n=!1){const a=parseFloat(e.replaceAll(",",""));e=!a&&0!=a||isNaN(a)?"":t?parseFloat(a).toFixed(t):a;return n||!e?e.toString():new Intl.NumberFormat("en-UK",{minimumFractionDigits:t}).format(e)}function datalists(e){for(const a in e){var t=document.createElement("datalist");for(const o of e[t.id=a]){var n=document.createElement("option");n.value=o,t.appendChild(n)}document.body.appendChild(t)}}function forceDatalist(e){!e.list.querySelector(`[value="${e.value}"]`)&&e.value&&"currencyInput"!=e.id?errorMessage(e,'Not a valid option. If you believe this is an error, submit a <a href="https://docs.google.com/forms/d/e/1FAIpQLSdXFIaHbeCWVsiaeIvcJL0A3aWiB5tQQFf2ofg0dr7lOkDChQ/viewform" rel="noreferrer noopener" target="_blank">bug report</a>.'):errorMessage(e)}function checkDataIntegrity(e=!1){var t,n,a,o,i;return!pageData.debug&&(t=JSON.stringify(pageData),n=dataIntegrityObj.text,a=pageData.name,o=pageData.portalglyphs,i=pageData.region,a&&o&&i&&(t==n&&!0===dataIntegrityObj.copy||e)?dataIntegrityObj.copy=!1:a?o&&i?"Copy code first!":"Wrong glyphs!":"Missing name!")}function removeNewlines(e){return e.replace(/\r?\n|\r/g,"")}function getSelectedText(e){const t=document.getElementById("switchTheme").innerText;var e=removeNewlines(e.closest(".wikiText").innerText).trim(),n=(n=removeNewlines(window.getSelection().toString()).trim()).endsWith(t)?n.replace(t,"").trim():n;dataIntegrityObj.text=JSON.stringify(pageData),dataIntegrityObj.copy=e==n}function enableTextMarking(){pageData.debug?document.body.dataset.mark=!0:document.body.dataset.mark=!checkDataIntegrity(!0)}function preventCopy(){var e=checkDataIntegrity(!0);e&&explanation("Missing/Incorrect Data",e)}function assignDefaultValue(e,t=e.dataset.default){e.value.trim()||wikiCode(t,e.dataset.dest??e.dataset.destNoauto)}function removeSection(e){for(const t of e)t.remove()}function removeSpecificSection(e,t="section"){removeSection(document.querySelectorAll(`[data-${t}="${e}"]`))}function hideOrgName(){var e=pageData.oldName,t=globalElements.output.oldName.parentElement;t.style.display=e?"":"none"}function getChildIndex(e,t){var n=[0];for(const o of e){var a=extractNumber(function e(t,n){if(void 0===t)return!1;const a=n.indexOf(".");if(-1<a)return e(t[n.substring(0,a)],n.substr(a+1));return t[n]}(o,t));n.push(parseInt(a))}return n.sort(function(e,t){return e-t}),n[n.length-1]+1}function sortObj(n,t=!1){if(!t)return Object.keys(n).sort().reduce((e,t)=>(e[t]=n[t],e),{});var e=Object.keys(sortObj(n)),a=e.map(e=>extractNumber(e)).map(Number).sort((e,t)=>e-t),o=new Object;for(const t of a){var i=e.findIndex(e=>extractNumber(e)==t),r=e[i];e.splice(i,1),o[r]=n[r]}return o}function extractNumber(e){return e?.match(/[0-9]/g)?.join("")??""}function oddEven(e){return e%2==0?"even":"odd"}addInputs(),addOutputs(),updateGlobalElements(commonElements),assignElementFunctions(elementFunctions),externalLinks(),openWikiLinksExternally(),toggleSection();