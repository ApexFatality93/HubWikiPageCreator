const regions={GHub:{F9556C30:"The Arm of Vezitinen",F9555C30:"Canthian",F9555C31:"Dexterf Sector",F9556C31:"The Arm of Katteus",F9557C31:"Nugsdor Adjunct",F9557C30:"Uefert Nebula",F9557C2F:"Widraik",F9556C2F:"Airnaka Conflux",F9555C2F:"Sivess Instability",FA556C30:"Savenix Instability",F8556C30:"Nonlopsi Instability"},CalHub:{F9556C30:"Uisaor Spur",F9555C30:"The Arm of Kiffeyn",F9555C31:"Ilongl Cloud",F9556C31:"The Arm of Taticale",F9557C31:"Egerap Anomaly",F9557C30:"Wakestones Expanse",F9557C2F:"Erhahn Fringe",F9556C2F:"Imrikians Terminus",F9555C2F:"Imedeili",FA556C30:"Kovasu Adjunct",F8556C30:"Lossians Boundary"},EisHub:{F9556C30:"Riwala",F9555C30:"Omskio Instability",F9555C31:"Marcki",F9556C31:"Anolamga Spur",F9557C31:"Sea of Zonyayp",F9557C30:"Rayuyar Band",F9557C2F:"Umaton Instability",F9556C2F:"Exramb Adjunct",F9555C2F:"Ologowe Fringe",FA556C30:"Yatrifex",FA555C30:"Yeiada Sector",FA555C31:"Iptrevs Fringe",FA556C31:"Yamiraith Sector",FA557C31:"Wedragi Spur",FA557C30:"Rezhensk",FA557C2F:"Sobert Cloud",FA556C2F:"Umtats Anomaly",FA555C2F:"Tavill",F8556C30:"Qangew Expanse",F8555C30:"Nijhwal Boundary",F8555C31:"Usband Cluster",F8556C31:"Ejongaa Anomaly",F8557C31:"Zahrel Expanse",F8557C30:"The Arm of Fupand",F8557C2F:"Cuculta",F8556C2F:"Etmarao",F8555C2F:"Otreie Void"}},GHubHuburbRegions={FA555C30:"Wekeram Conflux",FA555C31:"Ahomas Fringe",FA556C31:"Nudryorob Fringe",FA557C31:"Urzews Instability",FA557C30:"Ercays",FA557C2F:"Dahiloci Conflux",FA556C2F:"Rapphosu",FA555C2F:"Kemurrim Expanse",F8555C30:"Ardarea Sector",F8555C31:"Cetrocho Spur",F8556C31:"Guitat Cloud",F8557C31:"Unceto Cloud",F8557C30:"Yamurab Instability",F8557C2F:"Tenavata Terminus",F8556C2F:"Menacaro",F8555C2F:"Ziessuw Mass"};function addHuburbs(e){e.GHub??=new Object;for(const t in GHubHuburbRegions)e.GHub[t]=GHubHuburbRegions[t]}"undefined"!=typeof huburbs&&huburbs&&addHuburbs(regions),Object.freeze(regions);const versions=["Interceptor","Fractal","Waypoint","Endurance","Outlaws","SentinelUp","Frontiers","Prisms","Expeditions","Companions","NextGen","Origins","Desolation","Crossplay","ExoMech","Living Ship","Synthesis","Beyond","Visions","Abyss","NEXT","Atlas Rises","Pathfinder","Foundation","Release"],vowels="aeiou",wikiLink="https://nomanssky.fandom.com/wiki/";let uploadShown=!1;const links=new Object,pageData=new Object,cachedHTML={files:new Set},dataIntegrityObj={text:"",copy:""},globalElements={input:{},output:{}},commonElements={input:{version:"versionInput",civ:"civInput",fileInput:"fileInput",fileUpload:"fileUpload",portalglyphsInput:"portalglyphsInput",researchTeam:"researchteamInput",galleryUpload:"galleryUpload"},output:{output:"output",portalglyphButtons:"portalglyphButtons",galleryItems:"galleryItems",galleryCode:"galleryCode",explanation:"explanation",fullArticle:"fullArticle",actions:"actions",albumActions:"albumActions",albumEntry:"albumEntry",footer:"footer"}},elementFunctions={nameInput:["enableTextMarking()"],researchTeam:["researchTeam(); docBy()"],civ:["civ()"],portalglyphsInput:["glyphInputOnChange(this); displayGlyphs(); enableTextMarking()"],discoveredInput:['hideDiscoverer("discoveredInput", "discoveredlinkInput"); docBy()'],discoveredlinkInput:['hideDiscoverer("discoveredlinkInput", "discoveredInput"); docBy()'],docbyInput:["docBy()"],axesInput:["validateCoords()","onchange"]};function addInputs(){const e=document.querySelectorAll("input, select, textarea"),t=Object.values(commonElements.input);for(const n of e)t.includes(n.id)||(commonElements.input[n.id]=n.id)}function addOutputs(){const e=document.getElementsByTagName("output"),t=Object.values(commonElements.output);for(const n of e){if(t.includes(n.name)||t.includes(n.id))continue;const e=n.name||n.id;commonElements.output[e]=e}}function updateGlobalElements(e){for(const t in e)for(const n in e[t]){const o=e[t][n],a=Array.from(document.getElementsByName(o)),i=document.getElementById(o);a.length?e[t][n]=a:e[t][n]=i}for(const t in e)for(const n in e[t])globalElements[t][n]=e[t][n]}function assignElementFunctions(e){for(const t in e){if(!globalElements.input[t])continue;const n=globalElements.input[t],o=e[t][0];if(Array.isArray(n))for(const a of n)assignFunction(a,o,e[t][1],e[t][2]);else assignFunction(n,o,e[t][1],e[t][2])}}function getInputData(){return{inputs:document.querySelectorAll("[data-dest]"),checkboxes:document.querySelectorAll("[data-dest-checkbox]"),stores:document.querySelectorAll("[data-dest-noauto]"),defaults:document.querySelectorAll("[data-default]"),simple:document.querySelectorAll("[data-dest-simple]"),lists:document.querySelectorAll("[list]")}}function startUp(){autoShow(),readDefaultValues(),versionDropdown(),uploadShown=!0,galleryUploadShown=!0,showAll(),pageData.debug||(uploadShown=!1,galleryUploadShown=!1),enableTextMarking(),globalElements.output.output.onmousedown=()=>preventCopy(),globalElements.output.fullArticle.onmouseup=e=>getSelectedText(e.target),globalElements.output.fullArticle.ontouchend=e=>getSelectedText(e.target),globalElements.output.albumText&&(globalElements.output.albumText.ontouchend=e=>getSelectedText(e.target),globalElements.output.albumText.onmouseup=e=>getSelectedText(e.target)),preloadHTML()}function preloadHTML(){cachedHTML.files.forEach((e=>loadHTML(e)))}function versionDropdown(){const e=structuredClone(versions),t=e.indexOf("SentinelUp");e.splice(t,1,"Sentinel"),setDropdownOptions(globalElements.input.version,versions,e)}function setDropdownOptions(e,t,n=t){const o=new Array;for(let e=0;e<t.length;e++){const a=t[e],i=n[e],s=document.createElement("option");s.value=a,s.innerText=i,o.push(s.outerHTML)}const a=o.join("");e.innerHTML!=a&&(e.innerHTML=a)}function assignFunction(e,t,n=null,o=!1){const a=e.tagName.toLowerCase(),i=e.type,s=n??("select"==a||"radio"==i||"checkbox"==i?"onchange":"oninput");e.hasAttribute(s)?o?e.setAttribute(s,`${e.getAttribute(s)}; ${t}`):e.setAttribute(s,`${t}; ${e.getAttribute(s)}`):e.setAttribute(s,t)}function autoShow(){const e=getInputData();for(const t of e.defaults)assignFunction(t,"assignDefaultValue(this)");for(const t of e.inputs)assignFunction(t,"wikiCode(this)");for(const t of e.checkboxes)assignFunction(t,"checkboxWikiCode(this)");for(const t of e.stores)assignFunction(t,"storeData(this)");for(const t of e.simple)assignFunction(t,"wikiCodeSimple(this)");for(const t of e.lists)assignFunction(t,"forceDatalist(this)","onchange")}function showAll(){const e=getInputData();for(const t of e.inputs)wikiCode(t);for(const t of e.checkboxes)checkboxWikiCode(t);for(const t of e.stores)storeData(t);for(const t of e.defaults)assignDefaultValue(t);for(const t of e.simple)wikiCodeSimple(t);numberStats(),civ(),image(globalElements.input.fileUpload),"function"==typeof galleryUpload&&galleryUpload();try{glyphInputOnChange(globalElements.input.portalglyphsInput)}catch(e){}try{researchTeam()}catch(e){}try{planetMoonSentence()}catch(e){}hideDiscoverer();try{startupFunctions()}catch(e){console.warn(e)}}function wikiCode(e,t=e.dataset.dest){const n=getDestElements(t),o=sanitiseString(e.value??e);if(t){pageData[t]=o;for(const t of n)try{t.innerText=o}catch(t){console.error("destElement is null. Element:",e,"Value:",o,"Stacktrace:",t);continue}}else pageData[e.dataset.destNoauto]=o}function getDestElements(e){const t=Array.from(document.getElementsByName(e));if(0==t.length){const n=document.getElementById(e);n&&t.push(n)}return t}function checkboxWikiCode(e){const t=e.dataset.destCheckbox,n=document.getElementById(t),o=e.value,a=e.dataset.checkboxUnchecked??"";e.checked?(n.innerText=o,pageData[t]=o):(n.innerText=a,pageData[t]=a)}function storeData(e,t=e.dataset.destNoauto){pageData[t]=sanitiseString(e.value)}function externalLinks(){const e=document.getElementsByTagName("a");for(const n of e)t=n.href,new URL(t).origin!==location.origin&&(n.target||="_blank",n.rel||="noopener noreferrer");var t}function openWikiLinksExternally(){const e=document.querySelectorAll("a[data-wiki]");for(const t of e){t.target||="_blank",t.rel||="noopener noreferrer",delete t.dataset.wiki;const e=t.getAttribute("href");e.startsWith("http")||(t.href=wikiLink+e)}}function wikiCodeSimple(e){const t=e.dataset.destSimple,n=Array.from(document.getElementsByName(t));n.length||n.push(document.getElementById(t));for(const t of n)t.innerText=e.value}function addStaticPageData(e,t){Object.defineProperty(pageData,e,{configurable:!1,writable:!1,value:t})}function civ(){const e=globalElements?.input?.civ?.value;if(!e)return;const t=new Object;switch(e){case"GHub":t.galaxy="Euclid",t.civilized="Galactic Hub Project",t.civStub="GHub";break;case"CalHub":t.galaxy="Calypso",t.civilized="Galactic Hub Calypso",t.civStub="GHub Calypso";break;case"EisHub":t.galaxy="Eissentam",t.civilized="Galactic Hub Eissentam",t.civStub="GHub Eissentam"}pageData.civShort=e;for(const e in t)pageData[e]=t[e],getDestElements(e).length&&wikiCode(pageData[e],e);try{updateCiv()}catch(e){console.warn(e)}}function updateCiv(){researchTeamDropdown(),glyphRegion(pageData.portalglyphs),docBy()}function sanitiseString(e){const t=["{","}","[","]"],n=new Array,o=e.split("[http");for(let e=0;e<o.length;e++){const t=a(o[e],0!=e);n.push(t)}return n.join("[http").replace(/\n{3,}/g,"\n\n").trim();function a(e,n=!1){let o=e;for(const e of t)o=n&&"]"==e?s(o,e):i(o,e);return o}function i(e,t){const n=t.repeat(2);return e.split(n).map((e=>e.replaceAll(t,""))).join(n)}function s(e,t){const n=e.indexOf(t),o=i(e,t).split("");return o.splice(n,0,t),o.join("")}}function image(e){const t=e.files[0]?.name;if(!t)return;e.files[0].size>1e7?errorMessage(e,"This file is too big to be uploaded to the wiki. Maximum filesize is 10MB."):errorMessage(e);const n=e.previousElementSibling,o=sanitiseString(t);n.value=o,wikiCode(n),uploadShown||(explanation("Upload your picture to the wiki!",'Don\'t forget to upload your picture to the wiki on <a href="https://nomanssky.fandom.com/wiki/Special:Upload" target="_blank" rel="noopener noreferrer">Special:Upload</a>.\n\tThe upload button only auto-filled the image name into the code, it is not automatically uploaded to the wiki.\n\t<div class="mt-3"><span class="has-text-weight-bold">NOTE</span>: You can access this popup at any time by clicking on the "?" next to the main image upload button.</div>'),uploadShown=!0)}function toggleSection(e,t,n="section"){const o=document.querySelectorAll(`[data-${n}~="${e}"]`),a=getChildIndex(document.querySelectorAll("[data-button-id]"),"dataset.buttonId");if(0==arguments.length){const e=document.querySelectorAll(".sectionToggle button");for(let t=0;t<e.length;t++){const n=e[t];n.dataset.buttonId??=a+t;const o=n.dataset.buttonId;n.dataset[`display${o}`]=n.dataset.displayDefault??""}return}t.dataset.buttonId??=a;const i=`display${t.dataset.buttonId}`,s=t.dataset[i];for(const e of o){const t=e.dataset;let n=!1;for(const e in t)if(e.includes("display")&&e!=i&&"none"==t[e]){n=!0;break}n||(s?(e.style.display="",e.dataset[i]=""):(e.style.display="none",e.dataset[i]="none"))}t.innerText=s?"Hide":"Show",t.dataset[i]=s?"":"none"}function researchTeamDropdown(e=globalElements.input.researchTeam,t=pageData.civShort){if(!e)return;const n=e.value,o=["","GHGS","GHEC","GHSH","GHDF","GHBG","GHSL","GHTD","HBS"];switch(t){case"CalHub":o.push("CalHub Archivists");break;case"EisHub":o.push("EisHub Scribes","EPC","The Eissentimes Press")}setDropdownOptions(e,o),e.value=n,arguments.length||researchTeam()}function researchTeam(){const e=globalElements.input.researchTeam,t=e.value,n=e.dataset.destNoauto;pageData[n]=t;const o=pageData.civilized,a=["Base","Racetrack"],i=2==t.split(" ").length?o+" "+t.split(" ")[1]:t||a.includes(pageData.pageType)?t:o;globalElements.output[n].innerText=i}function docBy(){if("function"==typeof docByExternal)return void docByExternal();const e=globalElements.input.docbyInput;if(!e)return;const t=sanitiseString(e.value),n=pageData.discovered??pageData.builder,o=pageData.discoveredlink??pageData.builderlink,a=e.dataset.destNoauto,i=displayResearch(),s=formatName(t);t&&![n,o].includes(t)?(globalElements.output[a].style.display="",globalElements.output[a].innerText=`Documented by ${i} ${s}`):globalElements.output[a].style.display="none",addInfoBullet()}function displayResearch(){const e=pageData.researchteam;if(!e)return e;const t=globalElements.input.researchTeam.children,n=new Array;for(const e of t)n.push(e.value);return n.indexOf(e)<4?`[[${e}]] researcher`:e.includes("Scribe")?"EisHub [[Galactic Hub Eissentam Scribes|Scribe]]":e.includes("Archivist")?"CalHub [[Galactic Hub Calypso Archivists|Archivist]]":`[[${e}]] member`}function formatName(e){if(!e)return e;return e.includes("[")||e.includes("{")?e:`''${e}''`}function hideDiscoverer(e=null,t=null){if(!e&&!t){const e=document.querySelectorAll('[oninput*="hideDiscoverer"], [onchange*="hideDiscoverer"]'),t=new Set,n=new Array;for(const o of e){if(t.has(o))continue;const a=o.closest(".tableCell"),i=[a.previousElementSibling.previousElementSibling.querySelector("input"),a.nextElementSibling.nextElementSibling.querySelector("input")].find((t=>Array.from(e).includes(t))),s=[o,i];t.add(i),n.push(s)}for(const e of n){const t=e[0],n=e[1];t.value?hideDiscoverer(t.id,n.id):n.value?hideDiscoverer(n.id,t.id):e.forEach((e=>hideInput(e,"")))}return}const n=document.getElementById(e),o=document.getElementById(t);hideInput(o,n.value?"none":""),o.value="",wikiCode(o)}function addInfoBullet(){const e=document.querySelectorAll("[data-add-info]"),t=new Array;for(const n of e)!n.nextElementSibling.style.display&&n.nextElementSibling.innerText&&t.push(n),n.innerHTML="";for(const e of t)if(t.length>1){const t=e.dataset.addInfo;e.innerHTML=t}else e.innerHTML=""}function errorMessage(e,t=null){const n=e.closest(".data");if(n?.querySelector(".error")?.remove(),e.style.backgroundColor="",n.previousElementSibling.style.alignItems="",!t)return;e.style.backgroundColor="red";const o=document.createElement("div");o.innerHTML=t,o.className="error",n.appendChild(o),n.previousElementSibling.style.alignItems="baseline"}function validateCoords(e=!0){const t=globalElements.input.axesInput,n=t.value,o=new RegExp(/[+-](?:[0-9]{1,3})\.(?:[0-9]{2}), [+-](?:[0-9]{1,3})\.(?:[0-9]{2})/);if(n&&!regexMatch(n,o))return e&&errorMessage(t,"Invalid coordinate format"),"error";errorMessage(t)}function hideInput(e,t=null){const n=e.closest(".tableCell"),o=[n.previousElementSibling,n];for(const e of o)e.style.display?e.style.display=t??"":e.style.display=t??"none"}function enPrefix(e,t=null){const n=e?.match(/[a-zA-Z]/)?.[0]?.toLowerCase(),o=vowels.includes(n)?"an":"a";return t&&wikiCode(o,t),o}function regexMatch(e,t){const n=e.match(t);return 1==n?.length&&n[0]?.length==e.length}function docByResearchteam(e){return pageData.researchteam==e?` and documented by the [[Galactic Hub ${{GHSH:"Ship Hunters",GHEC:"Exobiology Corps"}[e]}]]`:""}function shortenGHub(e){return"GHub"==e||"Galactic Hub Project"==e?"Galactic Hub":e}function numberStats(e,t=null,n=!1){if(0==arguments.length){const e=document.querySelectorAll('[oninput*="numberStats"]');for(const t of e)numberStats(t);return}const o=e.dataset.destNoauto,a=numberError(e,pageData[o],t,n);getDestElements(o)[0]?wikiCode(a,o):pageData[o]=a}function numberError(e,t=e.value,n=null,o=!1){const a=getNumber(t,n,o);return a||!t||["+","-"].includes(t)?errorMessage(e):errorMessage(e,"Must only contain numbers"),a}function getNumber(e,t=null,n=!1){const o=parseFloat(e.replaceAll(",","")),a=!o&&0!=o||isNaN(o)?"":t?parseFloat(o).toFixed(t):o;return n||!a?a.toString():new Intl.NumberFormat("en-UK",{minimumFractionDigits:t}).format(a)}function datalists(e){for(const t in e){const n=document.createElement("datalist");n.id=t;for(const o of e[t]){const e=document.createElement("option");e.value=o,n.appendChild(e)}document.body.appendChild(n)}}function forceDatalist(e){!e.list.querySelector(`[value="${e.value}"]`)&&e.value&&"currencyInput"!=e.id?errorMessage(e,'Not a valid option. If you believe this is an error, submit a <a href="https://docs.google.com/forms/d/e/1FAIpQLSdXFIaHbeCWVsiaeIvcJL0A3aWiB5tQQFf2ofg0dr7lOkDChQ/viewform" rel="noreferrer noopener" target="_blank">bug report</a>.'):errorMessage(e)}function checkDataIntegrity(e=!1){if(pageData.debug)return!1;const t=JSON.stringify(pageData),n=dataIntegrityObj.text,o=pageData.name,a=pageData.portalglyphs,i=pageData.region;return o&&a&&i&&(t==n&&!0===dataIntegrityObj.copy||e)?(dataIntegrityObj.copy=!1,!1):o?a&&i?"Copy code first!":"Wrong glyphs!":"Missing name!"}function removeNewlines(e){return e.replace(/\r?\n|\r/g,"")}function getSelectedText(e){const t=document.getElementById("switchTheme").innerText,n=removeNewlines(e.closest(".wikiText").innerText).trim(),o=(()=>{const e=removeNewlines(window.getSelection().toString()).trim();return e.endsWith(t)?e.replace(t,"").trim():e})();dataIntegrityObj.text=JSON.stringify(pageData),dataIntegrityObj.copy=n==o}function enableTextMarking(){pageData.debug?document.body.dataset.mark=!0:document.body.dataset.mark=!checkDataIntegrity(!0)}function preventCopy(){const e=checkDataIntegrity(!0);e&&(explanation("Missing/Incorrect Data",e),enableTextMarking())}function assignDefaultValue(e,t=e.dataset.default){if(e.value.trim())return;wikiCode(t,e.dataset.dest??e.dataset.destNoauto)}function removeSection(e){for(const t of e)t.remove()}function removeSpecificSection(e,t="section"){removeSection(document.querySelectorAll(`[data-${t}="${e}"]`))}function hideOrgName(){const e=pageData.oldName,t=globalElements.output.oldName.parentElement;t.style.display=e?"":"none"}function getChildIndex(e,t){const n=[0];for(const a of e){const e=extractNumber(o(a,t));n.push(parseInt(e))}return n.sort((function(e,t){return e-t})),n[n.length-1]+1;function o(e,t){if(void 0===e)return!1;const n=t.indexOf(".");return n>-1?o(e[t.substring(0,n)],t.substr(n+1)):e[t]}}function sortObj(e,t=!1){if(!t)return Object.keys(e).sort().reduce(((t,n)=>(t[n]=e[n],t)),{});const n=Object.keys(sortObj(e)),o=n.map((e=>extractNumber(e))).map(Number).sort(((e,t)=>e-t)),a=new Object;for(const t of o){const o=n.findIndex((e=>extractNumber(e)==t)),i=n[o];n.splice(o,1),a[i]=e[i]}return a}function extractNumber(e){return e?.match(/[0-9]/g)?.join("")??""}function oddEven(e){return e%2==0?"even":"odd"}async function loadHTML(e,t={}){let n=await(async()=>{if(cachedHTML[e])return cachedHTML[e];const t=await fetch(e),n=await t.text();return cachedHTML[e]=n,n})();for(const e in t)n=n.replaceAll("${"+e+"}",t[e]);return(new DOMParser).parseFromString(n,"text/html")}addInputs(),addOutputs(),updateGlobalElements(commonElements),assignElementFunctions(elementFunctions),externalLinks(),openWikiLinksExternally(),toggleSection();
