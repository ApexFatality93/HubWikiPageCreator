(()=>{if(window.matchMedia("(pointer: coarse)").matches)return;const t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js",document.head.appendChild(t),t.onload=()=>{const t=globalElements.output.galleryItems;new Sortable(t,{handle:".handle",animation:250,onUpdate:function(t){moveItem(t)}})}})();let galleryUploadShown=!1;function galleryUpload(){const t=globalElements.input.galleryUpload;if(!t.value)return;const e=globalElements.output.galleryItems,n=globalElements.output.galleryCode,l=new Array;for(const o of t.files.length){const t=o.name;if(o.size>1e7){l.push(t);continue}const a=URL.createObjectURL(o),i=e.children,r=getChildIndex(i,"id"),s="pic"+r,c="dropdown"+r,d="wikiCodeGallery"+r,u="wikiCodeGalleryValue"+r,m=`\n\t\t<div id="${"gallery"+r}" class="gallery-item">\n\t\t\t<a class="gallery-media" href=${a} target="_blank" rel="noopener noreferrer">\n\t\t\t\t<img src="${a}">\n\t\t\t</a>\n\t\t\t<div class="gallery-meta">\n\t\t\t\t${(()=>{const e=document.createElement("p"),n=document.createElement("span");return e.innerText=t,n.classList.add("has-text-weight-bold"),n.innerText="Name: ",e.insertAdjacentElement("afterbegin",n),e.outerHTML})()}\n\t\t\t\t<div><select id="${c}" onchange="galleryDesc(this,'${s}', '${u}')"></select></div>\n\t\t\t\t<div><input id="${s}" type="text" placeholder="Description" oninput="galleryInput(this,'${u}')" /></div>\n\t\t\t</div>\n\t\t\t<div class="controlButtons">\n\t\t\t\t<span class="delete-icon is-clickable" title="Remove picture from gallery" onclick="rmGallery(this, '${d}')">&#10060</span>\n\t\t\t\t<img class="handle" src="./assets/vector/arrow.svg" title="Move picture up or down">\n\t\t\t\t<button class="button moveButton" title="Move up" onclick="mobileMoveItem(this, '${d}', 'up')">\n\t\t\t\t\t<svg width="36" height="36"><path d="M2 25h32L18 9 2 25Z"></path></svg>\n\t\t\t\t</button>\n\t\t\t\t<button class="button moveButton" title="Move down" onclick="mobileMoveItem(this, '${d}', 'down')">\n\t\t\t\t\t<svg width="36" height="36"><path d="M2 11h32L18 27 2 11Z"></path></svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>`;e.insertAdjacentHTML("afterbegin",m);const g=`<div id="${d}">\n\t\t\t<span>${t}</span><output id="${u}"></output>\n\t\t</div>`;n.insertAdjacentHTML("afterbegin",g);const p=document.getElementById(c);"function"==typeof generateGalleryArray&&generateGalleryArray();const y=pageData.galleryArray;y?setDropdownOptions(p,y):p.parentElement.style.display="none"}l.length?errorMessage(t,`The following files exceed the 10MB upload limit and couldn't be added: ${l.join(", ")}`):errorMessage(t),galleryUploadShown||("function"==typeof galleryExplanationExternal&&explanation("Gallery",`${galleryExplanationExternal()}\n\t\t<div class="mt-3"><span class="has-text-weight-bold">NOTE</span>: You can access this popup at any time by clicking on the "?" next to the gallery upload button.</div>`),galleryUploadShown=!0)}function galleryDesc(t,e,n){const l=t.value,o=document.getElementById(e);o.value=l,galleryInput(o,n)}function galleryInput(t,e){const n=sanitiseString(t.value);document.getElementById(e).innerText=n?"|"+n:""}function rmGallery(t,e){document.getElementById(e).remove(),t.closest(".gallery-item").remove()}function moveItem(t){const e=t.oldIndex,n=t.newIndex,l=Array.from(document.getElementById("galleryCode").children),o=l.splice(e,1);l.splice(n,0,o[0]);const a=new Array;for(const t of l){const e=t.outerHTML;a.push(e)}document.getElementById("galleryCode").innerHTML=a.join("")}function mobileMoveItem(t,e,n){const l=[t.closest(".gallery-item"),document.getElementById(e)];for(const t of l){const e=t.parentNode;"up"==n&&t.previousElementSibling?e.insertBefore(t,t.previousElementSibling):"down"==n&&t.nextElementSibling&&e.insertBefore(t,t.nextElementSibling.nextElementSibling)}}function resetGallery(){globalElements.output.galleryItems.innerHTML=""}
